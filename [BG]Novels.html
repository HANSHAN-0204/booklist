<!DOCTYPE html>

<html lang="zh-TW">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="bg.css" rel="stylesheet">
    <title>BOOKLIST—BG</title>
</head>

<body>
    <div class="top">
        <div class="search">
            <input id="password" placeholder="輸入關鍵字" type="text">
            <button id="unlock-btn">篩選</button>
        </div>
    </div>
    <div class="filter-container">
        <table>
            <tr>
                <th>
                    <p>評價</p>
                </th>
                <td>
                    <button class="filter-btn" data-filter="絕讚好味">#絕讚好味</button>
                    <button class="filter-btn" data-filter="還不錯吃">#還不錯吃</button>
                    <button class="filter-btn" data-filter="無聊可吃">#無聊可吃</button>
                    <button class="filter-btn" data-filter="勉強能吃">#勉強能吃</button>
                    <button class="filter-btn" data-filter="難以下嚥">#難以下嚥</button>
                    <button class="filter-btn" data-filter="沒嚼就吐">#沒嚼就吐</button>
                </td>
            </tr>
            <tr>
                <th>
                    <p>首發</p>
                </th>
                <td>
                    <button class="filter-btn" data-filter="未知">#未知</button>
                    <button class="filter-btn" data-filter="海棠">#海棠</button>
                    <button class="filter-btn" data-filter="晉江">#晉江</button>
                    <button class="filter-btn" data-filter="PO18">#PO18</button>
                </td>
            </tr>
            <tr>
                <th>
                    <p>時空</p>
                </th>
                <td>
                    <button class="filter-btn" data-filter="現代">#現代</button>
                    <button class="filter-btn" data-filter="架空">#架空</button>
                    <button class="filter-btn" data-filter="西幻">#西幻</button>
                    <button class="filter-btn" data-filter="古風">#古風</button>
                    <button class="filter-btn" data-filter="民國">#民國</button>
                    <button class="filter-btn" data-filter="未來">#未來</button>
                </td>
            </tr>
            <tr>
                <th>
                    <p>性向</p>
                </th>
                <td>
                    <button class="filter-btn" data-filter="常規">#常規</button>
                    <button class="filter-btn" data-filter="哨嚮">#哨嚮</button>
                    <button class="filter-btn" data-filter="ABO">#ABO</button>
                </td>
            </tr>
            <tr>
                <th>
                    <p>年齡</p>
                </th>
                <td>
                    <button class="filter-btn" data-filter="年上">#年上</button>
                    <button class="filter-btn" data-filter="年下">#年下</button>
                    <button class="filter-btn" data-filter="無差">#無差</button>
                    <button class="filter-btn" data-filter="NP">#NP</button>
                </td>
            </tr>
            <tr>
                <th>
                    <p>肉量</p>
                </th>
                <td>
                    <button class="filter-btn" data-filter="肉到噎死">#肉到噎死</button>
                    <button class="filter-btn" data-filter="大口吃肉">#大口吃肉</button>
                    <button class="filter-btn" data-filter="吃點肉塊">#吃點肉塊</button>
                    <button class="filter-btn" data-filter="喝點肉湯">#喝點肉湯</button>
                    <button class="filter-btn" data-filter="今天吃素">#今天吃素</button>
                </td>
            </tr>
            <tr>
                <th>
                    <p>標籤</p>
                </th>
                <td>
                    <button class="filter-btn" data-filter="暗戀">#暗戀</button>
                    <button class="filter-btn" data-filter="婚嫁">#婚嫁</button>
                    <button class="filter-btn" data-filter="人外">#人外</button>
                    <button class="filter-btn" data-filter="主僕">#主僕</button>
                    <button class="filter-btn" data-filter="主僕">#骨科</button>
                    <button class="filter-btn" data-filter="重生">#重生</button>
                    <button class="filter-btn" data-filter="穿越">#穿越</button>
                    <button class="filter-btn" data-filter="主僕">#青梅竹馬</button>
                    <button class="filter-btn" data-filter="破鏡重圓">#破鏡重圓</button>
                    <button class="filter-btn" data-filter="先做後愛">#先做後愛</button>
                </td>
            </tr>
            <tr>
                <th>
                </th>
                <td>
                    <button class="filter-btn" id="reset-btn" style="color: #AAAAAA;">清除篩選</button>
                </td>
            </tr>
        </table>
    </div>
    <div class="content-container" id="book-list"></div>
    <script>
        const bookList = document.getElementById("book-list");

        fetch("[BG]Novels.json")
            .then(res => res.json())
            .then(data => {
                data.forEach(book => {
                    const div = document.createElement("div");
                    div.className = "item";
                    div.setAttribute("data-category", book.tags.join(" "));

                    div.innerHTML = `
                        <p class="book">
                          <a href="#" class="locked" data-url="${book.url}">${book.title}</a><br>
                          <span>作者：${book.author}</span><br>
                          ${book.tags.map(t => `#${t}`).join(" ")}<br>
                          <span style="font-size: 0.6rem;">${book.desc || ""}</span>
                        </p>
                        <hr>
                      `;
                    bookList.appendChild(div);
                });
            });

        const buttons = document.querySelectorAll(".filter-btn");
        const resetButton = document.getElementById("reset-btn");
        const unlockButton = document.getElementById("unlock-btn");
        const passwordInput = document.getElementById("password");

        const correctPassword = "bd0e1cd36e4ad0a1055a4b17dff9d53a46b7f7fdf197af6b3fea4fe4802973e7";
        async function sha256(text) {
            const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(text));
            return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
        }
        unlockButton.addEventListener("click", async () => {
            const inputPassword = await sha256(passwordInput.value);

            if (inputPassword === correctPassword) {
                document.querySelectorAll(".locked").forEach(link => {
                    link.classList.remove("locked");
                    link.style.color = "#5A7FA2";
                    link.style.pointerEvents = "auto";
                    link.style.fontSize = "1rem";
                    link.href = link.getAttribute("data-url");
                });
            } else {
                alert("功能施工中！");
            }
        });

        function getItems() {
            return document.querySelectorAll(".item");
        }

        let activeFilters = new Set();

        buttons.forEach(button => {
            if (button.id !== "reset-btn") {
                button.addEventListener("click", () => {
                    const filter = button.getAttribute("data-filter");
                    if (activeFilters.has(filter)) {
                        activeFilters.delete(filter);
                        button.classList.remove("active");
                    } else {
                        activeFilters.add(filter);
                        button.classList.add("active");
                    }
                    filterItems();
                });
            }
        });

        resetButton.addEventListener("click", () => {
            activeFilters.clear();
            buttons.forEach(button => button.classList.remove("active"));
            getItems().forEach(item => item.classList.remove("hidden"));
        });

        function filterItems() {
            if (activeFilters.size === 0) {
                getItems().forEach(item => item.classList.remove("hidden"));
                return;
            }

            getItems().forEach(item => {
                const categories = item.getAttribute("data-category").split(" ");
                if ([...activeFilters].every(filter => categories.includes(filter))) {
                    item.classList.remove("hidden");
                } else {
                    item.classList.add("hidden");
                }
            });
        }
    </script>
</body>

</html>